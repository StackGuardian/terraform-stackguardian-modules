{
  "ui:title": "StackGuardian Autoscaled Private Runner for AWS",
  "ui:description": "Deploy an auto-scaling EC2 fleet of StackGuardian Private Runners with Lambda-based scaling. This module creates an Auto Scaling Group with a Lambda function that monitors the runner group queue and adjusts capacity accordingly.",
  "ui:order": [
    "stackguardian",
    "aws_region",
    "create_asg",
    "existing_asg_name",
    "ami_id",
    "runner_group_name",
    "runner_group_token",
    "storage_backend_role_arn",
    "s3_bucket_name",
    "instance_type",
    "override_names",
    "network",
    "volume",
    "firewall",
    "scaling",
    "runner_startup_timeout"
  ],
  "stackguardian": {
    "ui:title": "StackGuardian Configuration",
    "ui:description": "Configure your StackGuardian platform connection for the Lambda autoscaler",
    "ui:order": ["api_uri", "api_key", "org_name"],
    "api_uri": {
      "ui:widget": "select",
      "ui:description": "Select your StackGuardian API region"
    },
    "api_key": {
      "ui:placeholder": "sgu_***",
      "ui:description": "Your organization's API key on the StackGuardian Platform"
    },
    "org_name": {
      "ui:placeholder": "your-org-name (optional)",
      "ui:description": "Your organization name on the StackGuardian Platform. If not provided, will be extracted from environment."
    }
  },
  "aws_region": {
    "ui:widget": "select",
    "ui:description": "The target AWS Region for deployment"
  },
  "create_asg": {
    "ui:widget": "checkbox",
    "ui:description": "Whether to create a new Auto Scaling Group. Set to false to use an existing ASG and only deploy the Lambda autoscaler."
  },
  "existing_asg_name": {
    "ui:placeholder": "my-existing-asg",
    "ui:description": "Name of an existing Auto Scaling Group to use with the Lambda autoscaler"
  },
  "ami_id": {
    "ui:placeholder": "ami-***",
    "ui:description": "The AMI ID with pre-installed dependencies (docker, cron, jq, sg-runner). Required when create_asg is enabled."
  },
  "runner_group_name": {
    "ui:placeholder": "my-runner-group",
    "ui:description": "Name of the runner group on StackGuardian (from stackguardian_runner_group module)"
  },
  "runner_group_token": {
    "ui:placeholder": "sgr_*** (from runner group module)",
    "ui:description": "Authentication token for the runner group (from stackguardian_runner_group module)"
  },
  "storage_backend_role_arn": {
    "ui:placeholder": "arn:aws:iam::***:role/***",
    "ui:description": "ARN of the IAM role for S3 storage backend access (from stackguardian_runner_group module)"
  },
  "s3_bucket_name": {
    "ui:placeholder": "my-storage-bucket",
    "ui:description": "Name of the S3 bucket for storage backend (from stackguardian_runner_group module)"
  },
  "instance_type": {
    "ui:description": "The EC2 instance type for Private Runner instances (min 4 vCPU, 8GB RAM recommended)"
  },
  "override_names": {
    "ui:title": "Resource Naming Configuration",
    "ui:description": "Customize resource names (optional)",
    "ui:order": ["global_prefix", "include_org_in_prefix"],
    "global_prefix": {
      "ui:description": "Prefix for naming all AWS resources"
    },
    "include_org_in_prefix": {
      "ui:widget": "checkbox",
      "ui:description": "When enabled, appends organization name to the prefix (e.g., SG_RUNNER_my-org)"
    }
  },
  "network": {
    "ui:title": "Network Configuration",
    "ui:description": "Configure VPC and subnet settings for runner instances",
    "ui:order": [
      "vpc_id",
      "private_subnet_id",
      "public_subnet_id",
      "associate_public_ip",
      "create_network_infrastructure",
      "proxy_url",
      "additional_security_group_ids",
      "vpc_endpoint_security_group_ids"
    ],
    "vpc_id": {
      "ui:placeholder": "vpc-***",
      "ui:description": "Existing VPC ID for deployment"
    },
    "private_subnet_id": {
      "ui:placeholder": "subnet-***",
      "ui:description": "Private subnet ID for runner instances (for private deployments)"
    },
    "public_subnet_id": {
      "ui:placeholder": "subnet-***",
      "ui:description": "Public subnet ID (required when using NAT Gateway with create_network_infrastructure)"
    },
    "associate_public_ip": {
      "ui:widget": "checkbox",
      "ui:description": "Whether to assign public IPs to runner instances"
    },
    "create_network_infrastructure": {
      "ui:widget": "checkbox",
      "ui:description": "Create NAT Gateway and route tables for private subnet connectivity. Requires both private_subnet_id and public_subnet_id."
    },
    "proxy_url": {
      "ui:placeholder": "http://proxy.example.com:8080",
      "ui:description": "HTTP proxy URL for private network deployments (leave empty if not using a proxy)"
    },
    "additional_security_group_ids": {
      "ui:description": "Additional security group IDs to attach to instances (optional)",
      "items": {
        "ui:placeholder": "sg-***"
      }
    },
    "vpc_endpoint_security_group_ids": {
      "ui:description": "Security group IDs of VPC endpoints (STS, SSM, ECR, etc.). An inbound rule will be added to allow HTTPS (443) traffic from the runner.",
      "items": {
        "ui:placeholder": "sg-***"
      }
    }
  },
  "volume": {
    "ui:title": "EBS Volume Configuration",
    "ui:description": "Configure storage settings for runner instances",
    "ui:order": ["type", "size", "delete_on_termination"],
    "type": {
      "ui:widget": "select",
      "ui:description": "Type of the EBS volume"
    },
    "size": {
      "ui:description": "Size of the EBS volume in GB (minimum 8GB, 100GB recommended)"
    },
    "delete_on_termination": {
      "ui:widget": "checkbox",
      "ui:description": "Whether to delete the EBS volume on instance termination"
    }
  },
  "firewall": {
    "ui:title": "Security & SSH Configuration",
    "ui:description": "Configure SSH access and additional security rules",
    "ui:order": ["ssh_key_name", "ssh_public_key", "ssh_access_rules", "additional_ingress_rules"],
    "ssh_key_name": {
      "ui:placeholder": "my-keypair",
      "ui:description": "Name of existing SSH key pair in AWS"
    },
    "ssh_public_key": {
      "ui:widget": "textarea",
      "ui:placeholder": "ssh-rsa AAAAB3NzaC1yc2E...",
      "ui:options": {
        "rows": 3
      },
      "ui:description": "Custom SSH public key content (takes precedence over ssh_key_name)"
    },
    "ssh_access_rules": {
      "ui:description": "Map of CIDR blocks for SSH access (e.g., {\"office\": \"10.0.0.0/8\"})"
    },
    "additional_ingress_rules": {
      "ui:description": "Additional ingress rules with port, protocol, and cidr_blocks"
    }
  },
  "scaling": {
    "ui:title": "Auto Scaling Configuration",
    "ui:description": "Configure scaling behavior for the runner fleet",
    "ui:order": [
      "min_size",
      "max_size",
      "desired_capacity",
      "scale_out_threshold",
      "scale_in_threshold",
      "scale_out_step",
      "scale_in_step",
      "scale_out_cooldown_duration",
      "scale_in_cooldown_duration"
    ],
    "min_size": {
      "ui:description": "Minimum number of runner instances (must be at least 1)"
    },
    "max_size": {
      "ui:description": "Maximum number of runner instances"
    },
    "desired_capacity": {
      "ui:description": "Initial desired number of runner instances"
    },
    "scale_out_threshold": {
      "ui:description": "Number of queued jobs that triggers scale-out"
    },
    "scale_in_threshold": {
      "ui:description": "Number of queued jobs that triggers scale-in"
    },
    "scale_out_step": {
      "ui:description": "Number of instances to add per scale-out event"
    },
    "scale_in_step": {
      "ui:description": "Number of instances to remove per scale-in event"
    },
    "scale_out_cooldown_duration": {
      "ui:description": "Minutes to wait between scale-out events (minimum 4)"
    },
    "scale_in_cooldown_duration": {
      "ui:description": "Minutes to wait between scale-in events"
    }
  },
  "runner_startup_timeout": {
    "ui:description": "Maximum seconds to wait for Docker to start before shutting down instance"
  }
}
